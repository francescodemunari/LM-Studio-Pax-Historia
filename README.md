
# Pax Historia - WW2 Grand Strategy Game

ğŸ® A historically accurate grand strategy game set in the 1935-1945 period, featuring local generative AI powered by LM Studio.

![Version](https://img.shields.io/badge/Version-2.0.0-blue)
![Node.js](https://img.shields.io/badge/Node.js-18+-green)
![LM Studio](https://img.shields.io/badge/LM%20Studio-Required-orange)
![Storage](https://img.shields.io/badge/Storage-JSON-yellow)

## âœ¨ Features

- **Interactive World Map**: Historical 1936 HOI4 boundaries with SVG rendering.
- **Three Specialized AI Agents**: Game Master, Strategic Advisor, and Diplomacy Agent.
- **Action System**: Issue diplomatic, military, and economic orders.
- **Dynamic Events**: The world reacts to your actions with realistic consequences.
- **Historical Roadmaps**: 35+ nations with detailed timelines, strategic dilemmas, and "mistakes to avoid."
- **JSON Architecture**: No database required - everything is stored in JSON files for maximum simplicity.
- **City & Unit Visualization**: Markers for world capitals and historical military units.

## ğŸ“‹ Requirements

- **Node.js** 18+
- **LM Studio** with a local model loaded
- **Modern Browser** (Chrome, Firefox, Edge)

## ğŸš€ Installation

### 1. LM Studio Setup

1. Download and install [LM Studio](https://lmstudio.ai).
2. Download a compatible model (e.g., Llama 3 or Mistral).
3. Load the model and start the Local Server (port 1234).

### 2. Install Backend Dependencies

```bash
cd backend
npm install
```

### 3. Configure Environment Variables

The `.env` file is pre-configured with default values:

```env
LLM_API_URL=http://127.0.0.1:1234/v1
LLM_MODEL=your-model-name-here
PORT=3000
```

> âš ï¸ **IMPORTANT**: Ensure that `LLM_MODEL` exactly matches the identifier of the model loaded in LM Studio.

### 4. Start the Server

```bash
cd backend
npm start
```

### 5. Launch the Game

Open your browser and go to: **http://localhost:3000**

---

## ğŸ¯ How to Play

### Initial Setup
1. **New Game**: Choose from one of the 35+ playable nations.
2. **Start Date**: Select a starting year from 1935 to 1939 (Default: 1936-01-01).
3. **Loading**: The map will render with historical borders and your starting units.

### Game Interface

#### Action Panel
- Write diplomatic, military, or economic orders.
- The AI Game Master validates historical plausibility.
- Valid examples:
  - âœ… "Start partial mobilization on the eastern border."
  - âœ… "Send diplomats to [GER] to negotiate a non-aggression pact."
  - âœ… "Increase war production in northern factories."
  - âŒ "Build an F-35 jet" (Anachronistic).

#### Events Panel
- Displays world events generated by the AI.
- Events are classified by severity: minor, moderate, major, critical.
- Includes state consequences (stability, war support, treasury).

#### Timeline Panel
- A complete chronology of your actions and global events.
- Filterable by event type.

#### Diplomacy Panel
- Direct chat with leaders of other nations (AI-driven).
- Negotiate alliances, pacts, and trade deals.
- The AI adapts its tone and language to the historical context.

#### Strategic Advisor Panel
- Your personal AI advisor who knows your nation's history.
- Request strategic analyses, tactical advice, or summaries.
- Concise mode for quick responses ("OK" â†’ "At your command, my Liege.")

### Advancing Time
Choose the time step:
- 1 Week
- 1 Month
- 3 Months
- 6 Months
- 1 Year

The AI will generate realistic events based on the time period and your actions.

---

## ğŸ¤– AI Agents

Pax Historia uses **three specialized AI agents** with optimized prompts for specific roles:

### 1. Game Master (Event Generator)

**Role**: Simulator of world events and consequences of player actions.

**Prompt Key Points**:
- **CONSEQUENTIALITY**: Every action has a realistic historical weight.
- **GEOGRAPHIC SPECIFICITY**: Cites real cities, regions, and units.
- **MANDATORY TAGS**: Uses [ITA], [GER], [ETH], etc., for nations.
- **MILITARY DETAIL**: Mentions specific divisions (e.g., "2nd Eritrean Division").
- **OUTPUT**: Structured JSON with title, description, event_type, severity, and state_changes.

### 2. Strategic Advisor

**Role**: Personal advisor aware of the nation's historical roadmap.

**Prompt Key Points**:
- **HISTORY & PSYCHE**: Uses `narrative_history` to understand national motivations.
- **MISTAKE PREVENTION**: Warns about historical blunders (e.g., the Maginot Line for FRA).
- **REAL GEOGRAPHY**: Anchors advice to specific locations.
- **CONCISE MODE**: Responds with a single sentence to short messages.

### 3. Diplomacy Agent

**Role**: Roleplays as leaders of other nations during diplomatic chats.

**Prompt Key Points**:
- **PROFESSIONALISM**: Professional tone, no modern slang.
- **OPEN-MINDEDNESS**: Receptive but requires concrete answers.
- **TONE MATCHING**: Adapts tone to the player's style.
- **OUTPUT LENGTH RULE**: Matches player message length Â±10%.

---

## ğŸ“ Project Structure

```
PaxHistoria/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ server.js                  # Express server + WebSocket
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ game-engine.js         # Game state management (JSON-based)
â”‚   â”‚   â””â”€â”€ llm-service.js         # LM Studio integration (3 agents)
â”‚   â”œâ”€â”€ routes/                    # API Endpoints
â”‚   â””â”€â”€ scripts/                   # Utility scripts
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ index.html                 # Main page
â”‚   â”œâ”€â”€ css/                       # UI styling
â”‚   â”œâ”€â”€ js/
â”‚   â”‚   â”œâ”€â”€ app.js                 # Main app controller
â”‚   â”‚   â”œâ”€â”€ map.js                 # GameMap (Leaflet + SVG)
â”‚   â”‚   â””â”€â”€ panels/                # UI panels (Actions, Advisor, etc.)
â”‚   â””â”€â”€ 1936.svg                   # HOI4 world map SVG
â””â”€â”€ data/
    â”œâ”€â”€ nations_v2.json            # 35+ nations data
    â”œâ”€â”€ hoi4_map.json              # Region boundaries
    â”œâ”€â”€ cities.json                # World capitals coordinates
    â”œâ”€â”€ historical_roadmaps.json   # Roadmaps for AI Advisor
    â”œâ”€â”€ region_metadata.json       # Terrain, cities, neighbors
    â””â”€â”€ saves/                     # Game saves (auto-generated)
```

---

## ğŸ“Š JSON Data Examples

### `nations_v2.json`
Defines all playable nations:
```json
{
  "ITA": {
    "name": "Italy",
    "ideology": "fascism",
    "leader_name": "Benito Mussolini",
    "leader_title": "Il Duce",
    "manpower": 1500000,
    "color": "#56a552"
  }
}
```

### `historical_roadmaps.json`
Provides context for the AI Advisor:
```json
{
  "ITA": {
    "profile": "Rising fascist power...",
    "strategic_dilemmas": ["Expansion vs. Preparation"],
    "historical_mistakes": ["Premature invasion of Greece"],
    "narrative_history": "1861: Late unification creates an inferiority complex..."
  }
}
```

---

## ğŸ› ï¸ Development

### Adding a New Nation
1. Add an entry in `data/nations_v2.json`.
2. (Optional) Add a roadmap in `data/historical_roadmaps.json`.
3. Restart the server.

### Adding Cities
1. Edit `data/cities.json` with new coordinates.
2. Coordinates use the `[x, y]` format from the SVG map.

### Modifying AI Prompts
Edit the `PROMPTS` object in `backend/service/llm-service.js`.

---

## ğŸ“„ License

This is a personal/educational project. The original Pax Historia is a separate product.

## ğŸ¤ Credits

- Inspired by [Pax Historia](https://paxhistoria.co)
- Map Data: World War II historical boundaries
- AI: LM Studio + Local LLM deployment